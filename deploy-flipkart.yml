---
- name: Deploy Flipkart
  hosts: webservers
  become: yes
  connection: ssh
  user: ansible


  tasks:

    - name: Install packages
      yum:
        name: httpd 
        state: present
    
    - name: Ensure httpd is running
      service:
        name: httpd 
        state: started
        enabled: yes

    - name: Install Git
      yum:
        name: git
        state: present

    - name: Clone Flipkart
      git:
         repo: "https://github.com/Msocial123/Flipkart-Clone.git"
         dest: "/home/ansible/Flipkart-Clone"
         version: main
         force: yes
    - name: Remove default Apache index.html
      file:
         path: /var/www/html/index.html
         state: absent

    - name: Copy application
      copy:
         src: "/home/ansible/Flipkart-Clone"
         dest: "/var/www/html/"
         owner: apache
         group: apache
         remote_src: yes

    - name: Set correct Permission
      file: 
         path: /var/www/html/
         owner: apache
         group: apache
         mode: '0755'
         recurse: yes
